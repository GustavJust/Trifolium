---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/hero.astro";
---

<Layout>
  <Hero
    video="/assets/imgs/video/platform_office_video.mp4"
    title="Facilities"
    description="Trifolium offers modern, flexible facilities designed to support collaboration, innovation, and community across all activities and events."
    descLeft="Woodspace"
    descRight="1st Floor"
    poster="/assets/imgs/lazyload/facilities_lazyload.webp"
  />

  <section>
    <h2>Explore our facilites</h2>
    <nav class="hor_card">
      <a href="/offices"
        ><p>Offices</p><img src="../assets/imgs/arrow_icon_red.svg" alt="" /></a
      >
      <a href="/workshops"
        ><p>Workshops</p><img src="/assets/imgs/arrow_icon_red.svg" alt="" /></a
      >
      <a href="/photostudio"
        ><p>Photo-studio</p><img
          src="/assets/imgs/arrow_icon_red.svg"
          alt=""
        /></a
      >
      <a href="/page_not_found"
        ><p>Meeting & Conferences</p><img
          src="/assets/imgs/arrow_icon_red.svg"
          alt=""
        /></a
      >
      <a href="/page_not_found"
        ><p>Events</p><img src="/assets/imgs/arrow_icon_red.svg" alt="" /></a
      >
    </nav>
  </section>

  <section>
    <h2>
      A professional production village for designers, developers, and builders.
    </h2>
    <p>
      With workspaces, advanced tools, and workshops under one roof, you can
      create physical or digital products from concept to launch.
    </p>

    <div class="map_container">
      <div class="floor_select">
        <p>Floor</p>
        <button class="floor_btn" data-floor="0">1</button>
        <button class="floor_btn" data-floor="1">2</button>
        <button class="floor_btn" data-floor="2">3</button>
      </div>
      <div class="map_frame" id="mapFrame">
        <img
          src="/assets/imgs/floor_one_map.svg"
          alt="Floor 1"
          class="floor_img"
        />
        <img
          src="/assets/imgs/floor_two_map.svg"
          alt="Floor 2"
          class="floor_img"
        />
        <img
          src="/assets/imgs/floor_three_map.svg"
          alt="Floor 3"
          class="floor_img"
        />
      </div>

      <div class="explanation">
        <div class="thumbnail">
          <h4>NAME</h4>
          <img src="/assets/imgs/placeholder.png" alt="" />
        </div>
        <div class="card_contents">
          <div class="caption">
            <p>floor</p>
            <p>Type</p>
          </div>
          <div class="card_desc">
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Illum,
              aliquam non delectus at sapiente tempore veniam, esse molestias
              ullam aspernatur deleniti pariatur fugit, laborum provident itaque
              odio natus illo harum.
            </p>
            <a href="/">Read more</a>

            <div class="gallery_parent_container">
              <div class="gallery_container">
                <button id="prevBtn" aria-label="Previous slide">
                  <img src="/assets/imgs/icon_arrow.svg" alt="" class="left" />
                </button>
                <div class="gallery_frame" id="galleryFrame">
                  <img
                    src="/assets/imgs/placeholder.png"
                    alt=""
                    class="gallery_img"
                  />
                  <img
                    src="/assets/imgs/placeholder.png"
                    alt=""
                    class="gallery_img"
                  />
                  <img
                    src="/assets/imgs/placeholder.png"
                    alt=""
                    class="gallery_img"
                  />
                  <img
                    src="/assets/imgs/placeholder.png"
                    alt=""
                    class="gallery_img"
                  />
                  <img
                    src="/assets/imgs/placeholder.png"
                    alt=""
                    class="gallery_img"
                  />
                </div>
                <button id="nextBtn" aria-label="Next slide">
                  <img src="/assets/imgs/icon_arrow.svg" alt="" class="right" />
                </button>
              </div>
              <div class="gallery_pagination" id="galleryPagination">
                <div class="pagination-dot" data-index="0"></div>
                <div class="pagination-dot" data-index="1"></div>
                <div class="pagination-dot" data-index="2"></div>
                <div class="pagination-dot" data-index="3"></div>
                <div class="pagination-dot" data-index="4"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p>
      With workspaces, advanced tools, and workshops under one roof, you can
      create physical or digital products from concept to launch.
    </p>
    <a href="/contact">
      <button class="large">Get a tour</button>
    </a>
  </section>

  <script>
    window.addEventListener("DOMContentLoaded", function () {
      // Gallery logic
      const frame = document.getElementById("galleryFrame");
      const slides = frame.querySelectorAll(".gallery_img");
      const dots = document.querySelectorAll(".pagination-dot");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      let currentIndex = 0;
      const slideCount = slides.length;

      function updateActiveDot(index) {
        dots.forEach((dot) => (dot.style.backgroundColor = "white"));
        dots[index].style.backgroundColor = getComputedStyle(
          dots[index]
        ).borderColor;
      }

      function scrollToSlide(index) {
        const slideWidth = frame.clientWidth;
        frame.scrollTo({ left: index * slideWidth, behavior: "smooth" });
        currentIndex = index;
        updateActiveDot(index);
      }

      prevBtn.addEventListener("click", () => {
        scrollToSlide((currentIndex - 1 + slideCount) % slideCount);
      });

      nextBtn.addEventListener("click", () => {
        scrollToSlide((currentIndex + 1) % slideCount);
      });

      dots.forEach((dot, index) => {
        dot.addEventListener("click", () => {
          scrollToSlide(index);
        });
      });

      frame.addEventListener("scroll", () => {
        const scrollLeft = frame.scrollLeft;
        const slideWidth = frame.clientWidth;
        const index = Math.round(scrollLeft / slideWidth);
        if (index !== currentIndex) {
          currentIndex = index;
          updateActiveDot(index);
        }
      });

      updateActiveDot(0);

      // Floor switching logic
      const floorButtons = document.querySelectorAll(".floor_btn");
      const floorImages = document.querySelectorAll(".map_frame .floor_img");

      function setActiveFloor(index) {
        floorImages.forEach((img, i) =>
          img.classList.toggle("active", i === index)
        );
      }

      floorButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const index = parseInt(btn.getAttribute("data-floor"), 10);
          setActiveFloor(index);
        });
      });

      setActiveFloor(0); // Show floor 1 by default
    });
  </script>
</Layout>

<style>
  section {
    margin-left: var(--spacing-small);
    margin-right: var(--spacing-small);
  }

  .map_frame {
    width: 100%;
    display: grid;
    grid-template-columns: 1fr;
    overflow: hidden;
  }

  .floor_img {
    display: none;
    width: 100%;
    grid-area: 1/1/2/2;
    transform: scale(1.2);
  }

  .floor_img.active {
    display: block;
  }

  .floor_select {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--spacing-small);
  }

  .floor_btn {
    background-color: var(--color-white-100);
    border: 1px solid var(--primary-color-500);
    border-radius: 999px;
    width: 40px;
    height: 40px;
    font-weight: 700;
    font-size: 1.5em;
  }

  .floor_btn:hover {
    background-color: var(--primary-color-300);
  }

  .floor_btn:active {
    background-color: var(--primary-color-500);
    color: white;
  }

  .explanation .thumbnail {
    width: 100%;
  }

  .explanation .thumbnail img {
    width: 100%;
    height: auto;
  }

  .explanation .thumbnail h4 {
    margin: var(--spacing-tiny) 0;
  }

  .caption {
    display: flex;
    justify-content: space-between;
    text-transform: uppercase;
  }

  .caption p {
    margin: var(--spacing-tiny) 0;
  }

  .card_contents .card_desc a {
    text-decoration: underline;
  }

  .gallery_container {
    display: flex;
    align-items: center;
    height: 300px;
    gap: var(--spacing-tiny);
  }

  .gallery_frame {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    width: 100%;
    aspect-ratio: 1/1;
    flex: 3;
  }

  .gallery_img {
    flex: 0 0 100%;
    scroll-snap-align: start;
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }

  .gallery_container button {
    height: 40px;
    width: 40px;
    border-radius: 999px;
    border: 1px solid var(--primary-color-500);
    background-color: var(--color-white-100);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2;
  }

  .gallery_container button:hover {
    background-color: var(--primary-color-200);
  }

  .gallery_container button img.left {
    transform: scale(0.7) rotate(-135deg);
  }

  .gallery_container button img.right {
    transform: scale(0.7) rotate(45deg);
  }

  .gallery_pagination {
    margin: var(--spacing-tiny) 0;
    display: flex;
    justify-content: center;
    gap: var(--spacing-small);
  }

  .pagination-dot {
    width: 10px;
    aspect-ratio: 1/1;
    border-radius: 999px;
    border: 1px solid var(--primary-color-500);
    background-color: white;
    transition: background-color 0.3s;
  }

  .hor_card {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-tiny);
  }

  .hor_card > a {
    display: flex;
    justify-content: space-between;
    border: 1px solid var(--primary-color-500);
    font-weight: 700;
    font-size: 1.5em;
    padding: var(--spacing-tiny);
  }

  .hor_card > a p {
    margin: 0;
  }

  .hor_card > a:hover {
    background-color: var(--primary-color-200);
  }

  .hor_card > a img {
    transition: 0.05s ease-in;
  }

  .hor_card > a:hover img {
    rotate: 45deg;
  }

  .hor_card > a:active {
    background-color: var(--primary-color-500);
    color: white;
  }
</style>
